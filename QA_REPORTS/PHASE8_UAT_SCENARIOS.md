# تقرير User Acceptance Testing (UAT) - المرحلة 8
## User Acceptance Testing Scenarios Report - Phase 8

**التاريخ**: 2025-01-04  
**المراجع**: QA Engineer + Business Analyst  
**الحالة**: ✅ **مكتمل**

---

## ملخص

تم إنشاء **سيناريوهات User Acceptance Testing** شاملة لتغطية جميع حالات الاستخدام الرئيسية في النظام.

---

## السيناريوهات

### السيناريو 1: مواطن يرفع دعوى

#### الوصف:
مواطن يريد رفع دعوى قضائية جديدة.

#### الخطوات:
1. تسجيل الدخول كمواطن (`citizen1` / `password123`)
2. الدخول إلى `/api/lawsuits/`
3. إرسال POST request لإنشاء دعوى جديدة:
   ```json
   {
     "case_number": "2024/001",
     "gregorian_date": "2024-01-15",
     "hijri_date": "1445/06/03",
     "case_type": "civil",
     "court": "محكمة الاستئناف بصنعاء",
     "subject": "دعوى مطالبة مالية",
     "facts": "وقائع الدعوى...",
     "reasons": "الأسباب والأسانيد...",
     "requests": "الطلبات..."
   }
   ```

#### النتيجة المتوقعة:
- ❌ **403 Forbidden**: المواطن لا يستطيع رفع دعوى مباشرة

#### النتيجة الفعلية:
- ⚠️ **يجب**: المواطن يحتاج إلى محامي لرفع الدعوى نيابة عنه

#### ملاحظات:
- هذا السلوك صحيح حسب متطلبات النظام (المواطنون لا يستطيعون رفع دعاوى مباشرة)
- يجب إرشاد المستخدمين أن المواطن يحتاج محامي لرفع الدعوى

---

### السيناريو 2: محامي يرفع دعوى لمواطن

#### الوصف:
محامي يرفع دعوى جديدة لمواطن (كعميل).

#### الخطوات:
1. تسجيل الدخول كمحامي (`lawyer1` / `password123`)
2. الحصول على JWT Token من `/api/token/`
3. إرسال POST request لإنشاء دعوى:
   ```json
   {
     "case_number": "2024/002",
     "gregorian_date": "2024-01-16",
     "hijri_date": "1445/06/04",
     "case_type": "civil",
     "court": "المحكمة الابتدائية بصنعاء",
     "subject": "دعوى مطالبة مالية من المواطن",
     "facts": "وقائع الدعوى...",
     "reasons": "الأسباب والأسانيد القانونية...",
     "requests": "الطلبات المقدمة..."
   }
   ```
4. التحقق من إنشاء الدعوى بنجاح (201 Created)
5. إضافة مدعي (Plaintiff):
   ```json
   {
     "lawsuit_id": <id>,
     "name": "أحمد محمد علي",
     "gender": "male",
     "nationality": "يمني",
     "occupation": "موظف",
     "address": "صنعاء، شارع الزبيري",
     "phone": "777123456"
   }
   ```
6. إضافة مدعى عليه (Defendant):
   ```json
   {
     "lawsuit_id": <id>,
     "name": "خالد سعيد حسن",
     "gender": "male",
     "nationality": "يمني",
     "occupation": "تاجر",
     "address": "عدن، شارع كريتر",
     "phone": "777987654"
   }
   ```

#### النتيجة المتوقعة:
- ✅ **201 Created**: الدعوى تم إنشاؤها بنجاح
- ✅ **201 Created**: المدعي تم إضافته
- ✅ **201 Created**: المدعى عليه تم إضافته
- ✅ البيانات صحيحة ومكتملة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: جميع الخطوات تعمل بشكل صحيح

---

### السيناريو 3: محامي يضيف مرفقات للدعوى

#### الوصف:
محامي يضيف مستندات/مرفقات للدعوى.

#### الخطوات:
1. تسجيل الدخول كمحامي (`lawyer1` / `password123`)
2. الحصول على JWT Token
3. إرسال POST request لإضافة مرفق:
   ```json
   POST /api/attachments/
   Content-Type: multipart/form-data
   
   {
     "lawsuit_id": <id>,
     "document_type": "contract",
     "gregorian_date": "2024-01-17",
     "hijri_date": "1445/06/05",
     "page_count": 5,
     "content": "محتوى العقد...",
     "evidence_basis": "وجه الاستدلال من العقد...",
     "file": <file>
   }
   ```

#### النتيجة المتوقعة:
- ✅ **201 Created**: المرفق تم رفعه بنجاح
- ✅ الملف محفوظ في النظام
- ✅ البيانات صحيحة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: رفع الملفات يعمل بشكل صحيح

---

### السيناريو 4: محامي يضيف رد/مذكرة

#### الوصف:
محامي يضيف رد أو مذكرة للدعوى.

#### الخطوات:
1. تسجيل الدخول كمحامي (`lawyer1` / `password123`)
2. الحصول على JWT Token
3. إرسال POST request لإضافة رد:
   ```json
   {
     "lawsuit_id": <id>,
     "response_text": "نص الرد أو المذكرة الكامل...",
     "submitted_by": "المحامي خالد محمد",
     "submission_date": "2024-01-20",
     "hijri_date": "1445/06/08",
     "response_type": "memorandum"
   }
   ```

#### النتيجة المتوقعة:
- ✅ **201 Created**: الرد تم إضافته بنجاح
- ✅ البيانات صحيحة
- ✅ تاريخ التقديم محفوظ

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: إضافة الردود يعمل بشكل صحيح

---

### السيناريو 5: قاضي يعقد جلسة

#### الوصف:
قاضي يعقد جلسة للدعوى.

#### الخطوات:
1. تسجيل الدخول كقاضي (`judge1` / `password123`)
2. الحصول على JWT Token
3. إرسال POST request لإنشاء جلسة:
   ```json
   {
     "lawsuit_id": <id>,
     "hearing_date": "2024-02-01",
     "hijri_date": "1445/07/20",
     "hearing_time": "10:00:00",
     "notes": "تم عقد الجلسة وسماع أطراف الدعوى...",
     "judge_name": "القاضي محمد أحمد",
     "hearing_type": "main"
   }
   ```

#### النتيجة المتوقعة:
- ✅ **201 Created**: الجلسة تم إنشاؤها بنجاح
- ✅ القاضي مرتبط بالجلسة
- ✅ البيانات صحيحة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: فقط القضاة يمكنهم إنشاء الجلسات (403 للمحامي)

---

### السيناريو 6: قاضي يصدر حكم

#### الوصف:
قاضي يصدر حكم في الدعوى.

#### الخطوات:
1. تسجيل الدخول كقاضي (`judge1` / `password123`)
2. الحصول على JWT Token
3. إرسال POST request لإصدار حكم:
   ```json
   {
     "lawsuit_id": <id>,
     "judgment_type": "primary",
     "judgment_number": "J-2024/001",
     "judgment_date": "2024-04-01",
     "hijri_date": "1445/09/21",
     "judgment_text": "نص الحكم الكامل...",
     "summary": "ملخص الحكم: حكم لصالح المدعي...",
     "judge_name": "القاضي محمد أحمد",
     "court_name": "محكمة الاستئناف بصنعاء",
     "status": "executable"
   }
   ```
4. تحديث حالة الدعوى إلى "judged"

#### النتيجة المتوقعة:
- ✅ **201 Created**: الحكم تم إصداره بنجاح
- ✅ القاضي مرتبط بالحكم
- ✅ البيانات صحيحة
- ✅ يمكن إصدار أكثر من حكم للدعوى الواحدة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: فقط القضاة يمكنهم إصدار الأحكام (403 للمحامي)

---

### السيناريو 7: محامي يطعن في الحكم

#### الوصف:
محامي يطعن في حكم صادر.

#### الخطوات:
1. تسجيل الدخول كمحامي (`lawyer1` / `password123`)
2. الحصول على JWT Token
3. إرسال POST request لرفع طعن:
   ```json
   {
     "lawsuit_id": <id>,
     "appeal_type": "appeal",
     "appeal_number": "AP-2024/001",
     "appeal_reasons": "أسباب الطعن: مخالفة القانون...",
     "appeal_requests": "طلبات الطعن: إلغاء الحكم...",
     "higher_court": "محكمة التمييز",
     "appeal_date": "2024-04-15",
     "hijri_date": "1445/10/06",
     "submitted_by": "المحامي خالد محمد",
     "status": "pending"
   }
   ```
4. تحديث حالة الدعوى إلى "appealed"

#### النتيجة المتوقعة:
- ✅ **201 Created**: الطعن تم رفعه بنجاح
- ✅ المحامي مرتبط بالطعن
- ✅ البيانات صحيحة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: المحامي يمكنه رفع الطعون

---

### السيناريو 8: مواطن يطلع على دعاويه

#### الوصف:
مواطن يريد الاطلاع على دعاويه فقط.

#### الخطوات:
1. تسجيل الدخول كمواطن (`citizen1` / `password123`)
2. الحصول على JWT Token
3. إرسال GET request لعرض الدعاوى: `GET /api/lawsuits/`
4. محاولة الوصول إلى دعوى لمواطن آخر: `GET /api/lawsuits/<other_id>/`

#### النتيجة المتوقعة:
- ✅ **200 OK**: يعرض فقط دعاويه الخاصة
- ✅ **404 Not Found**: لا يمكنه الوصول إلى دعاوى الآخرين
- ✅ البيانات صحيحة

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: عزل البيانات يعمل بشكل صحيح

---

### السيناريو 9: قاضي يطلع على جميع الدعاوى

#### الوصف:
قاضي يريد الاطلاع على جميع الدعاوى في المحكمة.

#### الخطوات:
1. تسجيل الدخول كقاضي (`judge1` / `password123`)
2. الحصول على JWT Token
3. إرسال GET request لعرض الدعاوى: `GET /api/lawsuits/`
4. فلترة حسب المحكمة: `GET /api/lawsuits/?court=محكمة الاستئناف بصنعاء`
5. البحث: `GET /api/lawsuits/?search=2024/001`

#### النتيجة المتوقعة:
- ✅ **200 OK**: يعرض جميع الدعاوى
- ✅ الفلترة تعمل بشكل صحيح
- ✅ البحث يعمل بشكل صحيح

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: القاضي يمكنه الاطلاع على جميع الدعاوى

---

### السيناريو 10: عرض Audit Log

#### الوصف:
قاضي يريد الاطلاع على سجل الإجراءات (Audit Log).

#### الخطوات:
1. تسجيل الدخول كقاضي (`judge1` / `password123`)
2. الحصول على JWT Token
3. إرسال GET request لعرض Audit Logs: `GET /api/audit-logs/`
4. فلترة حسب نوع الإجراء: `GET /api/audit-logs/?action_type=lawsuit_created`
5. فلترة حسب الدعوى: `GET /api/audit-logs/?lawsuit=<id>`

#### النتيجة المتوقعة:
- ✅ **200 OK**: يعرض سجل الإجراءات
- ✅ الفلترة تعمل بشكل صحيح
- ✅ السجلات غير قابلة للتعديل أو الحذف
- ✅ جميع الإجراءات مسجلة تلقائياً

#### النتيجة الفعلية:
- ✅ **يجب التحقق**: Audit Log يعمل بشكل صحيح

---

## Checklist للاختبار

### Authentication & Authorization:
- [ ] تسجيل الدخول يعمل
- [ ] JWT Token يعمل
- [ ] Refresh Token يعمل
- [ ] الصلاحيات تعمل بشكل صحيح (403 للمحظور)

### Lawsuits:
- [ ] المحامي يمكنه إنشاء دعوى
- [ ] المواطن لا يستطيع إنشاء دعوى (403)
- [ ] المواطن يرى فقط دعاويه
- [ ] القاضي يرى جميع الدعاوى
- [ ] البحث والفلترة تعمل

### Parties:
- [ ] المحامي يمكنه إضافة مدعي/مدعى عليه
- [ ] المواطن لا يستطيع إضافة أطراف (403)

### Attachments:
- [ ] المحامي يمكنه رفع مرفقات
- [ ] الملفات محفوظة بشكل صحيح

### Responses:
- [ ] المحامي يمكنه إضافة ردود/مذكرات
- [ ] البيانات صحيحة

### Hearings:
- [ ] القاضي فقط يمكنه إنشاء جلسات
- [ ] المحامي لا يستطيع إنشاء جلسات (403)

### Judgments:
- [ ] القاضي فقط يمكنه إصدار أحكام
- [ ] المحامي لا يستطيع إصدار أحكام (403)
- [ ] يمكن إصدار أكثر من حكم للدعوى

### Appeals:
- [ ] المحامي يمكنه رفع طعون
- [ ] البيانات صحيحة

### Audit Log:
- [ ] السجلات غير قابلة للتعديل
- [ ] السجلات غير قابلة للحذف
- [ ] جميع الإجراءات مسجلة

---

## النتائج النهائية

### ✅ **النتيجة: UAT Scenarios جاهزة**

**التقييم**:
- ✅ جميع السيناريوهات الرئيسية مغطاة
- ✅ حالات الاستخدام موثقة
- ✅ النتائج المتوقعة محددة
- ✅ Checklist للاختبار

**التوصية**: ✅ **جاهز للمرحلة التالية (Release Readiness Checklist)**

---

## ملاحظات

1. **الاختبار الفعلي**: يجب تنفيذ جميع السيناريوهات يدوياً أو آلياً
2. **التوثيق**: يجب توثيق أي مشاكل أو انحرافات عن النتائج المتوقعة
3. **التصحيح**: يجب تصحيح أي مشاكل قبل الإطلاق

---

**الخطوة التالية**: المرحلة 9 - Release Readiness Checklist

